var nt=Object.create;var j=Object.defineProperty;var ot=Object.getOwnPropertyDescriptor;var st=Object.getOwnPropertyNames;var it=Object.getPrototypeOf,ct=Object.prototype.hasOwnProperty;var at=(t,e)=>{for(var r in e)j(t,r,{get:e[r],enumerable:!0})},C=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of st(e))!ct.call(t,o)&&o!==r&&j(t,o,{get:()=>e[o],enumerable:!(n=ot(e,o))||n.enumerable});return t};var ut=(t,e,r)=>(r=t!=null?nt(it(t)):{},C(e||!t||!t.__esModule?j(r,"default",{value:t,enumerable:!0}):r,t)),lt=t=>C(j({},"__esModule",{value:!0}),t);var kt={};at(kt,{extract:()=>et,extractFromJson:()=>v,extractFromXml:()=>tt,read:()=>It});module.exports=lt(kt);var k=(t="")=>{try{let e=new URL(t);return e!==null&&e.protocol.startsWith("http")}catch{return!1}},O=(t="",e="")=>{try{return new URL(e,t).toString()}catch{return""}},pt=["CNDID","__twitter_impression","_hsenc","_openstat","action_object_map","action_ref_map","action_type_map","amp","fb_action_ids","fb_action_types","fb_ref","fb_source","fbclid","ga_campaign","ga_content","ga_medium","ga_place","ga_source","ga_term","gs_l","hmb_campaign","hmb_medium","hmb_source","mbid","mc_cid","mc_eid","mkt_tok","referrer","spJobID","spMailingID","spReportId","spUserID","utm_brand","utm_campaign","utm_cid","utm_content","utm_int","utm_mailing","utm_medium","utm_name","utm_place","utm_pubreferrer","utm_reader","utm_social","utm_source","utm_swu","utm_term","utm_userid","utm_viz_id","wt_mc_o","yclid","WT.mc_id","WT.mc_ev","WT.srch","pk_source","pk_medium","pk_campaign"],I=t=>{try{let e=new URL(t);return pt.forEach(r=>{e.searchParams.delete(r)}),e.toString().replace(e.hash,"")}catch{return null}};var U=ut(require("cross-fetch"),1),mt=async(t,e={})=>{let{proxy:r={},signal:n=null}=e,{target:o,headers:s={}}=r;return await(0,U.default)(o+encodeURIComponent(t),{headers:s,signal:n})},R=async(t,e={})=>{let{headers:r={"user-agent":"Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0"},proxy:n=null,agent:o=null,signal:s=null}=e,i=n?await mt(t,{proxy:n,signal:s}):await(0,U.default)(t,{headers:r,agent:o,signal:s}),l=i.status;if(l>=400)throw new Error(`Request failed with error code ${l}`);let c=i.headers.get("content-type"),a=await i.text();if(/(\+|\/)(xml|html)/.test(c))return{type:"xml",text:a.trim(),status:l,contentType:c};if(/(\+|\/)json/.test(c))try{return{type:"json",json:JSON.parse(a),status:l,contentType:c}}catch{throw new Error("Failed to convert data to JSON object")}throw new Error(`Invalid content type: ${c}`)};var dt=t=>({}).toString.call(t);var x=t=>Array.isArray(t),E=t=>String(t)===t,M=t=>Number(t)===t;var w=t=>dt(t)==="[object Object]"&&!x(t);var d=(t,e)=>!t||!e?!1:Object.prototype.hasOwnProperty.call(t,e);var P=t=>{let e=M(t)?String(t):t;if(!E(e))throw new Error("InvalidInput: String required.");return e},N=(t,e=140)=>{let r=P(t);if(r.length<=e)return r;let o=r.substring(0,e).trim(),s=o.split(" ");return s.length>1?(s.pop(),s.map(l=>l.trim()).join(" ")+"..."):o.substring(0,e-3)+"..."},z=t=>P(t).replace(/(<([^>]+)>)/ig,"").trim();var A=require("fast-xml-parser"),J=(t={})=>d(t,"rss")&&d(t.rss,"channel"),$=(t={})=>d(t,"feed")&&d(t.feed,"entry"),W=(t={})=>d(t,"rdf:RDF")&&d(t["rdf:RDF"],"channel"),V=t=>!E(t)||!t.length?!1:A.XMLValidator.validate(t)===!0,X=(t="",e={})=>{let r={attributeNamePrefix:"@_",ignoreAttributes:!1,...e};return new A.XMLParser(r).parse(t)};var B=require("html-entities");var y=t=>{try{return t?new Date(t).toISOString():""}catch{return""}},S=(t,e=0)=>{let r=z(String(t).trim().replace(/^<!\[CDATA\[|\]\]>$/g,""));return(e>0?N(r,e):r).replace(/\n+/g," ")},u=t=>{let e=w(t)?t._text||t["#text"]||t._cdata||t.$t:t;return e?(0,B.decode)(String(e).trim()):""},L=(t=[],e="")=>{if(w(e)&&d(e,"@_isPermaLink")&&e["@_isPermaLink"]==="true")return u(e);let r=o=>{let s=o.map(i=>L(i));return s.length>0?s[0]:""},n=E(t)?u(t):w(t)&&d(t,"href")?u(t.href):w(t)&&d(t,"@_href")?u(t["@_href"]):w(t)&&d(t,"@_url")?u(t["@_url"]):w(t)&&d(t,"_attributes")?u(t._attributes.href):x(t)?r(t):"";return n||(k(e)?e:"")},b=(t,e="",r)=>{let n=L(t,e),o=I(n);return n?o||O(r,n):""},ft=t=>Math.abs(t.split("").reduce((e,r)=>Math.imul(31,e)+r.charCodeAt(0)|0,0)).toString(36),D=(t,e,r)=>t?u(t):ft(b(e))+"-"+new Date(r).getTime(),gt=t=>{let e=d(t,"@_url")?t["@_url"]:"",r=d(t,"@_type")?t["@_type"]:"",n=Number(d(t,"@_length")?t["@_length"]:0);return!e||!r?null:{url:e,type:r,length:n}},q=t=>w(t)?{text:u(t),domain:t["@_domain"]}:t,G=(t,e)=>e==="source"?{text:u(t),url:L(t)}:e==="category"?x(t)?t.map(q):q(t):e==="enclosure"?gt(t):t;var xt=(t,e)=>{let{useISODateFormat:r,descriptionMaxLen:n,baseUrl:o,getExtraEntryFields:s}=e,{id:i="",title:l="",url:c="",date_published:a="",summary:f="",content_html:g="",content_text:p=""}=t,h=r?y(a):a,_=s(t);return{...{id:D(i,c,a),title:l,link:I(c)||O(o,c),published:h,description:S(p||g||f,n)},..._}},ht=(t,e)=>{let{normalization:r,baseUrl:n,getExtraFeedFields:o}=e;if(!r)return t;let{title:s="",home_page_url:i="",description:l="",language:c="",items:a=[]}=t,f=o(t),g=x(a)?a:[a];return{title:s,link:I(i)||O(n,i),description:l,language:c,published:"",generator:"",...f,entries:g.map(p=>xt(p,e))}},H=(t,e={})=>ht(t,e);var _t=(t,e)=>{let{useISODateFormat:r,descriptionMaxLen:n,baseUrl:o,getExtraEntryFields:s}=e,{guid:i="",title:l="",link:c="",pubDate:a="",description:f="","content:encoded":g=""}=t,p=r?y(a):a,h=u(f||g),_={id:D(i,c,a),title:u(l),link:b(c,i,o),published:p,description:S(h,n)},m=s(t);return{..._,...m}},bt=(t,e)=>{let{title:r="",link:n="",item:o}=t,i=(x(o)?o:[o]).map(c=>{let{id:a,title:f="",link:g=""}=c,p={...c,title:u(f),link:b(g,a,e)};return"guid description source".split(" ").forEach(m=>{d(c,m)&&(p[m]=u(c[m]))}),"source category enclosure author image".split(" ").forEach(m=>{d(p,m)&&(c[m]=G(p[m],m))}),p});return{...t,title:u(r),link:b(n,e),item:x(o)?i:i[0]}},yt=(t,e={})=>{let{normalization:r,baseUrl:n,getExtraFeedFields:o}=e,s=t.rss.channel;if(!r)return bt(s,n);let{title:i="",link:l="",description:c="",generator:a="",language:f="",lastBuildDate:g="",item:p=[]}=s,h=o(s),_=x(p)?p:[p],m=e.useISODateFormat?y(g):g;return{title:u(i),link:b(l,"",n),description:c,language:f,generator:a,published:m,...h,entries:_.map(F=>_t(F,e))}},K=(t,e={})=>yt(t,e);var wt=(t,e)=>{let{useISODateFormat:r,descriptionMaxLen:n,baseUrl:o,getExtraEntryFields:s}=e,{id:i="",title:l="",issued:c="",modified:a="",updated:f="",published:g="",link:p="",summary:h="",content:_=""}=t,m=f||a||g||c,F=u(h||_),T={id:D(i,p,m),title:u(l),link:b(p,i,o),published:r?y(m):m,description:S(F,n)},rt=s(t);return{...T,...rt}},St=(t,e)=>{let{id:r,title:n="",link:o="",entry:s}=t,l=(x(s)?s:[s]).map(a=>{let{id:f,title:g="",link:p="",summary:h="",content:_=""}=a,m={...a,title:u(g),link:b(p,f,e)};return d(m,"summary")&&(m.summary=u(h)),d(m,"content")&&(m.content=u(_)),m});return{...t,title:u(n),link:b(o,r,e),entry:x(s)?l:l[0]}},Dt=(t,e={})=>{let{normalization:r,baseUrl:n,getExtraFeedFields:o}=e,s=t.feed;if(!r)return St(s,n);let{id:i="",title:l="",link:c="",subtitle:a="",generator:f="",language:g="",updated:p="",entry:h=[]}=s,_=o(s),m=x(h)?h:[h],F=e.useISODateFormat?y(p):p;return{title:u(l),link:b(c,i,n),description:a,language:g,generator:f,published:F,..._,entries:m.map(T=>wt(T,e))}},Q=(t,e={})=>Dt(t,e);var Ft=(t,e)=>{let{useISODateFormat:r,descriptionMaxLen:n,baseUrl:o,getExtraEntryFields:s}=e,{guid:i="",title:l="",link:c="","dc:date":a="",description:f="","content:encoded":g=""}=t,p=r?y(a):a,h=u(f||g),_={id:D(i,c,a),title:u(l),link:b(c,i,o),published:p,description:S(h,n)},m=s(t);return{..._,...m}},Et=(t,e)=>{let{title:r="",link:n="",item:o}=t,i=(x(o)?o:[o]).map(c=>{let{id:a,title:f="",link:g=""}=c;return{...c,title:u(f),link:b(g,a,e)}});return{...t,title:u(r),link:b(n,e),item:x(o)?i:i[0]}},Ot=(t,e={})=>{let{normalization:r,baseUrl:n,getExtraFeedFields:o}=e,s=t["rdf:RDF"];if(!r)return Et(s,n);let{title:i="",link:l="",description:c="",generator:a="","dc:language":f="","dc:date":g=""}=s.channel,{item:p}=s,h=o(s),_=x(p)?p:[p],m=e.useISODateFormat?y(g):g;return{title:u(i),link:b(l,"",n),description:c,language:f,generator:a,published:m,...h,entries:_.map(F=>Ft(F,e))}},Y=(t,e={})=>Ot(t,e);var Z=(t={})=>{let{normalization:e=!0,descriptionMaxLen:r=250,useISODateFormat:n=!0,xmlParserOptions:o={},baseUrl:s="",getExtraFeedFields:i=()=>({}),getExtraEntryFields:l=()=>({})}=t;return{normalization:e,descriptionMaxLen:r,useISODateFormat:n,xmlParserOptions:o,baseUrl:s,getExtraFeedFields:i,getExtraEntryFields:l}},v=(t,e={})=>H(t,Z(e)),tt=(t,e={})=>{if(!V(t))throw new Error("The XML document is not well-formed");let r=Z(e),n=X(t,r.xmlParserOptions);return J(n)?K(n,r):$(n)?Q(n,r):W(n)?Y(n,r):null},et=async(t,e={},r={})=>{if(!k(t))throw new Error("Input param must be a valid URL");let n=await R(t,r);if(!n.text&&!n.json)throw new Error(`Failed to load content from "${t}"`);let{type:o,json:s,text:i}=n;return o==="json"?v(s,e):tt(i,e)},It=async(t,e,r)=>(console.warn("WARNING: read() is deprecated. Please use extract() instead!"),et(t,e,r));function jt(){var r,n;if(((r=process.env.FEED_EXTRACTOR_CJS_IGNORE_WARNING)==null?void 0:r.toLowerCase())==="true")return;let t=o=>`\x1B[33m${o}\x1B[39m`;(((n=process.env.FEED_EXTRACTOR_CJS_TRACE_WARNING)==null?void 0:n.toLowerCase())==="true"?console.trace:console.warn)(t("The CJS build of @extractus/feed-extractor is deprecated. See https://github.com/extractus/feed-extractor#cjs-deprecated for details."))}jt();0&&(module.exports={extract,extractFromJson,extractFromXml,read});
//# sourceMappingURL=bundle.cjs.map
